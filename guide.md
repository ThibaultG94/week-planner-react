# Guide de développement WeekPlanner

## 1. État Actuel du Projet (18/12/2024)

### 1.1 Frontend (En cours)

- Application React fonctionnelle avec drag & drop
- Interface d'authentification implémentée :
- ✓ AuthContext avec Supabase
- ✓ Formulaires de connexion/inscription
- ✓ Bannière d'avertissement pour utilisateurs non connectés
- En attente :
- Migration des données localStorage vers Supabase
- Adaptation du TaskContext pour Supabase
- Synchronisation des données

### 1.2 Backend (Complété)

- Supabase configuré :

```sql
Table users (
  id uuid primary key,
  created_at timestamptz default now(),
  email text unique,
  display_name text
)

Table tasks (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  title text not null,
  note text null,
  location_type text not null default 'parking'::text,
  day text null,
  period text null,
  position bigint not null default '0'::bigint,
  completed boolean not null default false,
  user_id uuid references public.users(id)
)
- RLS configuré

## 2. Prochaine Étape : Migration vers Supabase

La prochaine étape majeure consiste à adapter notre TaskContext pour utiliser Supabase comme stockage principal. Cela implique plusieurs volets :

### 2.1 TaskContext

Pour adapter le TaskContext vers Supabase, nous devons :

1. Modifier le TaskContext pour utiliser l'API Supabase :
 - Implémenter les méthodes CRUD avec Supabase
 - Gérer le chargement initial des données
 - Gérer les erreurs et retours utilisateur
 - Maintenir la compatibilité localStorage pour utilisateurs non connectés

2. Gérer la synchronisation des données :
 - Optimistic updates
 - Gestion des conflits
 - État de chargement et erreurs

### 2.2 Optimisations
- Cache local des données Supabase
- Gestion optimiste des mises à jour
- Gestion hors-ligne

## 3. Migration des données

### 3.1 Architecture implémentée
- taskMigration.js : Logique de transformation et envoi des données
- Gestion UI dans App.jsx avec états de chargement
- Détection automatique des données locales à la connexion
- Migration ou suppression au choix de l'utilisateur

### 3.2 Processus de migration
1. Détection des données locales à la connexion
2. Dialogue de confirmation avec options :
 - Migration vers Supabase
 - Suppression des données locales
3. Gestion des erreurs et feedback utilisateur

## 4. Roadmap

### 4.1 Court Terme
1. Migration des données (En cours)
2. Adapter TaskContext pour Supabase
3. Tests et débogage
4. Optimisations de performance

### 4.2 Moyen Terme
- Système de partage d'agendas
- Statistiques d'utilisation
- Mode hors-ligne complet

## 5. Standards Techniques

### 5.1 État des données
- Supabase comme source principale
- Cache local pour performance
- État React pour UI

### 5.2 Authentification
- Gestion via Supabase Auth
- Sessions persistantes
- Sécurité RLS

### 5.3 Gestion des erreurs
- Retours utilisateur clairs
- Logging des erreurs
- Fallbacks appropriés
```
